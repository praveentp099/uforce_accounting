{% extends 'base.html' %}

{% block title %}{{ worker.name }}'s Attendance | uForce Accounting{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1><i class="fas fa-user-clock"></i> {{ worker.name }}'s Attendance</h1>
        <h5 class="text-muted">Report {{ filter_description }}</h5>
    </div>
    <a href="{% url 'attendance_list' %}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to Worker List</a>
</div>

<!-- Filter Forms -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <!-- Filter by Month -->
            <div class="col-md-5">
                <form method="get" class="d-flex align-items-end">
                    <div class="flex-grow-1">
                        <label for="month_year" class="form-label">Filter by Month</label>
                        <input type="month" id="month_year" name="month_year" value="{{ month_year_filter }}" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-primary ms-2">Go</button>
                </form>
            </div>
            <div class="col-md-1 text-center d-flex align-items-center justify-content-center">
                <strong class="text-muted">OR</strong>
            </div>
            <!-- Filter by Date Range -->
            <div class="col-md-6">
                <form method="get" class="row g-3 align-items-end">
                    <div class="col">
                        <label for="start_date" class="form-label">Start Date</label>
                        <input type="date" id="start_date" name="start_date" value="{{ start_date|date:'Y-m-d' }}" class="form-control">
                    </div>
                    <div class="col">
                        <label for="end_date" class="form-label">End Date</label>
                        <input type="date" id="end_date" name="end_date" value="{{ end_date|date:'Y-m-d' }}" class="form-control">
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-primary">Filter</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header d-flex justify-content-between">
        <h5 class="mb-0">Attendance Records</h5>
        <span class="fw-bold">Total Wage for Period: Đ{{ totals.total_wages|default:0|floatformat:2 }}</span>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Project</th>
                        <th>In Time</th>
                        <th>Out Time</th>
                        <th>Hours</th>
                        <th>Overtime</th>
                        <th class="text-end">Wage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in attendances %}
                    <tr>
                        <td data-label="Date">{{ record.date }}</td>
                        <td data-label="Project">{{ record.project.name }}</td>
                        <td data-label="In Time">{{ record.in_time|time:"H:i" }}</td>
                        <td data-label="Out Time">{{ record.out_time|time:"H:i" }}</td>
                        <td data-label="Hours">{{ record.hours_worked|floatformat:2 }}</td>
                        <td data-label="Overtime">{{ record.overtime_hours|floatformat:2 }}</td>
                        <td data-label="Wage" class="text-end">Đ{{ record.total_wage|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">No attendance records found for this period.</td>
                    </tr>
                    {% endfor %}
                </tbody>
                 {% if attendances %}
                <tfoot>
                    <tr class="fw-bold table-group-divider">
                        <td colspan="4" class="text-end">Period Totals:</td>
                        <td>{{ totals.total_hours|default:0|floatformat:2 }}</td>
                        <td>{{ totals.total_overtime|default:0|floatformat:2 }}</td>
                        <td class="text-end">Đ{{ totals.total_wages|default:0|floatformat:2 }}</td>
                    </tr>
                </tfoot>
                {% endif %}
            </table>
        </div>
    </div>
</div>
{% endblock %}

